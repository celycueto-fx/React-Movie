'use client';
import { PopularMovieInterface } from '@/utils/PopularMovie';
import React, { useState, useEffect} from 'react';
import PopularMoviesList from '../../app/components/PopularMoviesComponent/PopularMoviesList';
import PopularSeries from '../../app/components/PopularSeriesComponent/PopularSeries';
import TopRatedMovies from '../../app/components/TopRatedMoviesComponent/TopRatedMovies';
import { API_KEY, POPULAR_IMG_URL } from '@/utils/Constants';
import { ENDPOINT_GET_POPULARMOVIES, ENDPOINT_URL_IMAGES } from '@/app/enviroments/EndoPoints';
import { Container, ContainerMoviePage, ImageMovie, ImageMoviePopular, TextSubTitle, TextTitle } from './popularMovieStyle';
import configureStore from '@/app/GlobalRedux/stores/ConfigureStore';
import { Provider} from "react-redux";

const PopularMovie = () => {
  const [movies, setMovies] = useState<PopularMovieInterface>();
  const store = configureStore();

  store.subscribe(() =>
   console.log(store.getState())
 )

  useEffect(() => {
    const fetchMovies = async () => {
      try {
        const response = await fetch(`${ENDPOINT_GET_POPULARMOVIES}?api_key=${API_KEY}`);
        if (response.ok) {
          const data = await response.json();
          setMovies(data.results[0]);
        } else {
          throw new Error('Error al obtener las películas');
        }
      } catch (error) {
        console.error(error);
      }
    };

    fetchMovies();
  }, []);


  return (

    <Provider store={store}>

    <ContainerMoviePage>

      <Container>
        <ImageMoviePopular src={`${ENDPOINT_URL_IMAGES}${movies?.backdrop_path}`} alt={movies?.title}>
        </ImageMoviePopular>
        <TextTitle>{movies?.title}</TextTitle>
        <TextSubTitle >Más Popular</TextSubTitle>
        <ImageMovie src={`${POPULAR_IMG_URL}`} ></ImageMovie>

      </Container>
      <div className='contenedor'>
        <div><PopularMoviesList></PopularMoviesList></div>
        <div>  <PopularSeries></PopularSeries></div>
        <div><TopRatedMovies></TopRatedMovies></div>

      </div>

    </ContainerMoviePage>
</Provider> 

  );
};

export default PopularMovie;
